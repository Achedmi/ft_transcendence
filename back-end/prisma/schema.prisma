// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Status {
  ONLINE
  OFFLINE
  INGAME
  INQUEE
}

enum ChatType {
  DM
  CHANNEL
}

enum Visibility {
  PUBLIC
  PRIVATE
  PROTECTED
}

model Message {
  id        Int      @default(autoincrement()) @id
  message   String
  userId Int?
  chatId Int?
  chat Chat? @relation(fields: [chatId], references: [id])
  user User? @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}

model Chat {
  id        Int      @default(autoincrement()) @id
  type ChatType
  visibility Visibility
  name String?
  ownerId Int?
  createdAt DateTime @default(now())
  owner User? @relation("owner", fields: [ownerId], references: [id])
  members User[] 
  messages Message[]
}

model User {
  id    Int     @default(autoincrement()) @id
  username String  @unique
  displayName String
  avatar String
  level Float  @default(0)
  status  Status @default(ONLINE)
  isTFAenabled Boolean @default(false)
  TFAsecret String? 
  
  friends  User[] @relation("friends")
  friendOf User[] @relation("friends")
  
  bio String? @default("Nothing to see here...")
  createdAt DateTime @default(now())
  player1 Game[] @relation("player1")
  player2 Game[] @relation("player2")
  winnerPlayer Game[] @relation("winnerPlayer")
  chats Chat[]
  owner Chat[]  @relation("owner")
  messages Message[]
}

model Game {
  createdAt DateTime @default(now())
  id        Int      @default(autoincrement()) @id
  player1    User?    @relation("player1", fields: [player1Id], references: [id])
  player2    User?    @relation("player2", fields: [player2Id], references: [id])
  player1Score Int
  player2Score Int
  winnerPlayer User? @relation("winnerPlayer", fields: [winnerPlayerId], references: [id])
  player1Id  Int?
  player2Id  Int?
  winnerPlayerId Int?
}

